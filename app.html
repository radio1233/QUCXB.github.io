import pygame

# Constants
WIDTH, HEIGHT = 800, 600
BLOCK_SIZE = 20
PLAYER_VELOCITY = 1  # Adjust the player velocity
WHITE = (255, 255, 255)
BLACK = (0, 0, 0)
GRAY = (200, 200, 200)
GREEN = (0, 255, 0)
RED = (255, 0, 0)
BLUE = (0, 0, 255)
BROWN = (165, 42, 42)

# Initialize Pygame
pygame.init()
win = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("Minecraft-like Game")

# Player variables
player_x, player_y = WIDTH // 2, HEIGHT // 2
player_width, player_height = BLOCK_SIZE, BLOCK_SIZE

# Door variables
door_x, door_y = None, None
door_width, door_height = BLOCK_SIZE, BLOCK_SIZE
door_open = False
door_exists = False

# Blocks
blocks = []

# Grass
grass_blocks = []

# Block selection
selected_block = GRAY
block_types = [GRAY, GREEN, BLUE, BROWN]

# Menu
def draw_menu():
    pygame.draw.rect(win, BLACK, (0, 0, WIDTH, 40))
    font = pygame.font.SysFont(None, 30)
    text = font.render("1: Gray Block, 2: Green Block, 3: Blue Block, 4: Brown Block, Left click: Place block, Right click: Remove block, E: Place/Remove Door", True, WHITE)
    win.blit(text, (10, 10))
    pygame.draw.rect(win, selected_block, (WIDTH - 60, 5, 30, 30))

# Main loop
run = True
while run:
    win.fill(WHITE)
    draw_menu()
    
    # Handle events
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            run = False
        elif event.type == pygame.MOUSEBUTTONDOWN:
            if event.button == 1:  # Left mouse button to place block
                block_x = event.pos[0] // BLOCK_SIZE * BLOCK_SIZE
                block_y = event.pos[1] // BLOCK_SIZE * BLOCK_SIZE
                if (block_x, block_y) != (door_x, door_y):  # Prevent placing block on the door
                    blocks.append((block_x, block_y, selected_block))
            elif event.button == 3:  # Right mouse button to remove block
                block_x = event.pos[0] // BLOCK_SIZE * BLOCK_SIZE
                block_y = event.pos[1] // BLOCK_SIZE * BLOCK_SIZE
                if (block_x, block_y) in [(block[0], block[1]) for block in blocks]:
                    blocks = [block for block in blocks if (block[0], block[1]) != (block_x, block_y)]
        elif event.type == pygame.KEYDOWN:
            if event.key == pygame.K_1:  # Select gray block
                selected_block = GRAY
            elif event.key == pygame.K_2:  # Select green block
                selected_block = GREEN
            elif event.key == pygame.K_3:  # Select blue block
                selected_block = BLUE
            elif event.key == pygame.K_4:  # Select brown block
                selected_block = BROWN
            elif event.key == pygame.K_e:  # E key to place/remove door
                if not door_exists:
                    door_x, door_y = player_x, player_y
                    door_exists = True
                    door_open = False
                else:
                    door_exists = False

    # Draw blocks
    for block in blocks:
        pygame.draw.rect(win, block[2], (block[0], block[1], BLOCK_SIZE, BLOCK_SIZE))

    # Draw grass
    for grass_block in grass_blocks:
        pygame.draw.rect(win, GREEN, (grass_block[0], grass_block[1], BLOCK_SIZE, BLOCK_SIZE))

    # Draw door if it exists
    if door_exists:
        door_color = GREEN if door_open else RED
        pygame.draw.rect(win, door_color, (door_x, door_y, door_width, door_height))

    # Draw player
    pygame.draw.rect(win, RED, (player_x, player_y, player_width, player_height))

    # Handle player movement with collision detection
    keys = pygame.key.get_pressed()
    new_player_x = player_x
    new_player_y = player_y

    if keys[pygame.K_a] and player_x > 0:
        new_player_x -= PLAYER_VELOCITY
    if keys[pygame.K_d] and player_x < WIDTH - player_width:
        new_player_x += PLAYER_VELOCITY
    if keys[pygame.K_w] and player_y > 0:
        new_player_y -= PLAYER_VELOCITY
    if keys[pygame.K_s] and player_y < HEIGHT - player_height:
        new_player_y += PLAYER_VELOCITY

    # Create player rectangle
    player_rect = pygame.Rect(new_player_x, new_player_y, player_width, player_height)

    # Check collision with blocks
    collision = False
    for block in blocks:
        block_rect = pygame.Rect(block[0], block[1], BLOCK_SIZE, BLOCK_SIZE)
        if player_rect.colliderect(block_rect):
            collision = True
            break

    # Check collision with door if it is closed
    if door_exists and not door_open:
        door_rect = pygame.Rect(door_x, door_y, door_width, door_height)
        if player_rect.colliderect(door_rect):
            collision = True

    # Update player position if no collision
    if not collision:
        player_x = new_player_x
        player_y = new_player_y

    pygame.display.update()

pygame.quit()
